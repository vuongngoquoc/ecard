<div id="show_personalize_table" style="display:none" >
	<div class="temp_personalize col-sm-9">
		<form name="ecardmax_personalize" class="form-horizontal" method="post" action="index.php">
		<input type="hidden" name="step" value="{'step'}" />
		<input type="hidden" name="what" value="send_to_friends" />
		<input type="hidden" name="list_email" value="" />
		<input type="hidden" name="cs_poem" value="{'cs_poem'}" />
		<input type="hidden" name="cs_poem_align" value="center" />  
		<input type="hidden" name="cs_music_filename" value="{'cs_music_filename'}" /> 
		<input type="hidden" name="cs_music_id" value="{'cs_music_id'}" />
		<input type="hidden" name="cs_skin_name" value="{'cs_skin_name'}" />
		<input type="hidden" name="cs_stamp_filename" value="{'cs_stamp_filename'}" />
		<input type="hidden" name="cs_java" value="{'cs_java'}" />
		<input type="hidden" name="ec_id" value="{'ec_id'}" />
		<input type="hidden" name="tw_user" value="{'tw_user'}" />
		<input type="hidden" name="tw_psw" value="{'tw_psw'}" />
		<input type="hidden" name="oAuth" value="{'oAuth'}" />
		<input type="hidden" name="embed_text" value="{'embed_text1'}"/>
		<div class="table_border">
			<div class="info_card_send">
            	<div class="panel panel-default">
                    <div class="panel-heading">{'fieldset_title_sender_information'}</div>
                    <div class="panel-body">
                        <div class="input-group input-group-sm h-space-b-10">
                          <span class="input-group-addon" id="sizing-addon3">
                          <i class="fa fa-user"></i> <span class="only-desktop">{'fieldset_sender_name'}</span></span>
                          <!--input onkeydown="showid2('show_error_message_sender_info','none');" id="cs_from_name" class="form-control" name="cs_from_name" value="{'cs_from_name'}" type="text" {'cs_from_name_read_only_if_login'} aria-describedby="sizing-addon" /-->    
						  
						  <input onkeydown="showid2('show_error_message_sender_info','none');" id="cs_from_name" class="form-control" name="cs_from_name" value="{'cs_from_name'}" type="text"  aria-describedby="sizing-addon" />    
						  
                        </div>   
                        <div class="Error_Message" style="padding:5px;display:none" id="show_error_message_sender_info" ></div>       
                        <div class="input-group input-group-sm">
                          <span class="input-group-addon" id="sizing-addon3">
                          @ <span class="only-desktop">{'fieldset_sender_email'}</span></span>
                          <!--input onkeydown="showid2('show_error_message_sender_info','none');"  onblur="if(!valid_email(this.value)){this.value='';ShowDivInvalidEmail('show_error_message_sender_info');}" id="cs_from_email" class="form-control" name="cs_from_email" value="{'cs_from_email'}" type="text" {'cs_from_name_read_only_if_login'} aria-describedby="sizing-addon" /-->  

							<input onkeydown="showid2('show_error_message_sender_info','none');"  onblur="if(!valid_email(this.value)){this.value='';ShowDivInvalidEmail('show_error_message_sender_info');}" id="cs_from_email" class="form-control" name="cs_from_email" value="{'cs_from_email'}" type="text" aria-describedby="sizing-addon" />  
							
                        </div>
                        <div class="Error_Message" style="padding:5px;display:none" id="show_error_message_sender_info" ></div>
                    </div>
                </div>
				
                <div class="panel panel-default">
                    <div class="panel-heading">{'fieldset_title_recipient_information'}</div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-3">{'fieldset_number_recipient'}</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                <input aria-describedby="sizing-addon" class="form-control  input-sm no-border-r" onkeypress="return isNumberKey(event)" onfocus="original_value=this.value;" onchange="CheckFieldNumber(this.value);" id="re_num" name="re_num" value="{'cf_recipient_default'}" type="text" /> 
                                <div class="input-group-addon no-backg">
                                <small class="text-danger">{'fieldset_maximum_is'} {'cf_max_friend_email'}</small>
                                </div>
                            </div>
                            </div>
                        </div>
                        <div class="form-group">
                        	<label class="col-sm-3" ></label>
                        	<div class="col-sm-8">
                            	<a onclick="toggleIt();" href="javascript:;">{'twitter_recipient'}</a>
								<div id="twitter_recipient" class="elm-toggle-collapse">{'twitter_message'}</div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3">{'add_from_address_book'}</label>
                            <div class="col-sm-8">
                                <select aria-describedby="sizing-addon" class="form-control input-sm" onchange="AddContactGroupToList(this.value);">
                                    <option value="0">{'select_group'}</option>
                                    {'show_contact_group_options'}
                                </select>
                                <p class="text-right"><small>{'select_or_choise'}</small></p>
                            </div>
                        </div>
                                        
                        <div class="form-group">
                            <div class="col-sm-1 add-more pull-right text-left">
                            <a href="javascript:;" class="text-right" onclick="AddMore();">
                                <i class="fa fa-plus"></i></a>	 
                            </div>
                            <label class="col-sm-3">Recipient</label>
                            <div class="col-sm-8" id="show_recipient_loop"></div>
                        </div>
        
                        <div class="clearfix"></div>
                    </div>
                </div>
        
				
				<div class="panel panel-default">
                    <div class="panel-heading">{'email_template'}</div>
                    <div class="panel-body">
                     <div class="form-group">
                    	<div class="Error_Message" style="padding:5px;display:none" id="show_error_message_sender_info" ></div>
                         <label class="col-sm-3">{'email_subject'}</label>
                         <div class="col-sm-9">
                        <input class="form-control input-sm" onkeydown="showid2('show_error_message_sender_info','none');" id="email_subject_from_name" name="email_subject_from_name" value="{'email_subject_from_name'}" type="text" /><br clear="all" />
                        </div>
                        <!------MESSAGE MOVE TO TAB DESIGN CARD----->
                        <textarea name="cs_message" id="cs_message" class="cs_message elm-toggle-collapse">{'cs_message'}</textarea>
                        <!------END--------------------------------->
                        </div>
                        
                        <div class="form-group">
                        	<div class="col-sm-8">
                                {'checkbox_save_recipient_to_addressbook'}
                                <div><input name="cs_copy" id="cs_copy" type="checkbox" value="1" /> {'txt_send_me_copy_this_card'}</div>
                                <div><input name="cs_notify" type="checkbox" value="1" /> {'txt_notify_me_when_recipient_view_card'}</div>
                                {'checkbox_signup_newsletter'}
                                {'checkbox_signup_special_offer'}
                            </div>
                            <div class="col-sm-4">
                                <label>{'fieldset_delivery_date'}</label>
                                {'show_delivery_date'}
                            </div>
                        </div>
					</div>
                </div>
                {'show_account_balance_if_ppc'}
			</div>
		</div>
		<!-- End Column Personal info-->
		</form>    
    <div id="show_change_next_step_fav_toolbar" style="position:relative; z-index:99999999" class="sendcard-toolbar">
			<span onclick="PreviewCard();" class="btn btn-default btn-sm">
            <i class="fa fa-eye padding5"></i>{'show_personalize_table_button_preview_card'}</span>
            <span onclick="SendToFriends();" class="btn btn-default btn-sm btn-my-site">
            <i class="fa fa-send padding5"></i>{'sendcard_php_button_send_now'}</span>
	</div>
    </div>
	<div class="recepient_address col-sm-3">
        {'show_address_book'}
    </div>
</div>
<!-----SCRIPT-------->
{'myloop'}
<!-----END----------->
<script type="text/javascript">
	currentIndex=0;
	//var re_num="1";
	//WriteRecipientLoop();
	document.getElementById("list_friend_name_1").value="{'show_list_friend_name_1'}";
	document.getElementById("list_friend_email_1").value="{'show_list_friend_email_1'}";

	function SendToFriends(){
		//Get data from Hoteditor
		get_hoteditor_data();

		if(document.getElementById("cs_from_name").value==""){
			ShowPersonalizeTable();
			document.getElementById("show_error_message_sender_info").innerHTML="{'txt_js_alert_must_enter_sender_name'}";
			showid2("show_error_message_sender_info","block");
			document.getElementById("cs_from_name").focus();
			
			return false;
		}
		else if(!valid_email(document.getElementById("cs_from_email").value)){
			ShowPersonalizeTable();
			document.getElementById("show_error_message_sender_info").innerHTML="{'txt_js_alert_must_enter_sender_email'}";
			showid2("show_error_message_sender_info","block");
			document.getElementById("cs_from_email").focus();			
			return false;
		}
		else if(html_output==""){
			ShowPersonalizeTable();
			showNotification("You must enter your personal message");			
			return false;
		}
		else{
			var check_recipient_info=false;
			var data="";
			var list_friend_name="";
			var list_friend_email="";
			for(i=1;i<=re_num;i++){
				list_friend_name=document.getElementById("list_friend_name_"+i).value;
				list_friend_email=document.getElementById("list_friend_email_"+i).value;
				if(list_friend_name!="" && list_friend_email!=""){
					check_recipient_info=true;
					list_friend_name=list_friend_name.replace(";",",");
					data+=list_friend_name+";"+list_friend_email+"\n";
				}
				if(list_friend_name!="" && list_friend_email=="" || list_friend_name=="" && list_friend_email!=""){
					check_recipient_info=false;
					data="1";
					document.getElementById("show_error_message_"+i).innerHTML="{'txt_js_alert_missing_recipient'}";
					showid2("show_error_message_"+i,"block");
					document.getElementById("list_friend_name_"+i).focus();
				}
			}

			if(check_recipient_info==false){
				ShowPersonalizeTable();
				if(data==""){
					document.getElementById("show_error_message_1").innerHTML="{'txt_js_alert_must_enter_recipient_info'}";
					showid2("show_error_message_1","block");
					document.getElementById("list_friend_name_1").focus();
				}				
				return false;
			}
			else{
				if(document.getElementById("cs_copy").checked==true){
					list_friend_name=document.getElementById("cs_from_name").value;
					list_friend_name=list_friend_name.replace(";",",");
					list_friend_email=document.getElementById("cs_from_email").value;
					data+=list_friend_name+";"+list_friend_email;
				}
				document.ecardmax_personalize.list_email.value=data;
				document.ecardmax_personalize.what.value="send_to_friends";
				document.ecardmax_personalize.submit();
			}
		}
	}


	function InsertDate(id,data){
		showid2('popup_calendar','none');
		document.getElementById('time_end_textbox').value=data;			
	}


	function PreviewCard(){
		setWidthCardBoundary();
		//Update sender info
		from_sender_name=document.getElementById("cs_from_name").value + " ("+document.getElementById("cs_from_email").value+")";
		document.getElementById("card_from").innerHTML=from_sender_name;

		//Update number send to
		to_name="<select size=\"1\">";
		for(i=1;i<=re_num;i++){
			list_friend_name=document.getElementById("list_friend_name_"+i).value;
			list_friend_email=document.getElementById("list_friend_email_"+i).value;
			if(list_friend_name!="" && list_friend_email!=""){
				to_name+="<option>"+list_friend_name+" ("+list_friend_email+")</option>\n";
			}		
		}
		to_name+="</select>";
		document.getElementById("card_to").innerHTML=to_name;
		
		//Update card message 
		get_hoteditor_data();

		//Add Youtube Yahoo Google video
		html_output=html_output.replace(/\[FLASH=(.*?),(.*?)\](.*?)\[\/FLASH\]/gi,'<object width="$1" height="$2"><param name="movie" value="$3"></param><param name="wmode" value="transparent"></param><embed src="$3" type="application/x-shockwave-flash" wmode="transparent" width="$1" height="$2"></embed></object>');

		user_message=html_output;
		document.getElementById("card_message").innerHTML=html_output;

		showid2('show_personalize_table','none');
		showid2('div_card_body','block');
		showid2('show_edit_sendnow_toolbar_bottom','block');
		showid2('card-body-right','none');	
		$('#card-body-left').addClass('full-width');
		scrollToElm('div_card_body');
	}
	
	function EditCard(){
		setWidthCardBoundary(true);
		showid2('div_card_body','block');
		showid2('card-body-right','block');	
		$('#card-body-left').removeClass('full-width');
		showid2('show_personalize_table','none');
		showid2("show_edit_sendnow_toolbar_bottom","none");
		scrollToElm('div_card_body');
	}
	
	function valideEmail(obj,i){
		if(!valid_email(obj.value)){
			if(obj.value.indexOf("@")!=-1 || obj.value.indexOf("d ")!=-1){
				if(document.ecardmax_personalize.tw_user.value=="" && document.ecardmax_personalize.oAuth.value==""){
					currentIndex=i;
					HideItAll();
					if(window.confirm('{'twitter_login_message'}')){
						location.href="{'cf_twitter_authorize_url'}";
					}
				}
			}else{
				ShowDivInvalidEmail(i);	
			}
		}
	}	
	function toggleIt()
	{
		jQuery('#twitter_recipient').animate({height: 'toggle'},200, function(){});
	}

	function share_to_social(type){
		get_hoteditor_data();
		var text=$('#cs_message').html();
		if (text==null || text=="")  {
			showNotification("You must enter your personal message");
			return false;
		}
		else {
			document.ecardmax_personalize.what.value="share_to_friends";
			$.ajax({
				type: "POST",
				async: false,
				url: "{'ecard_url'}/index.php",
				data: $("form[name=ecardmax_personalize]").serialize(),
				success: function(msg) {
					var link="";
					if (type=='twitter') {
						link="http://twitter.com/intent/tweet?text=An%20Awesome%20Link&url=" + encodeURIComponent(msg);
					}
					if (type=='facebook') {
					current_url=encodeURIComponent(msg); 
						//link="https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(msg);
                                                var winHeight = 500;
                                                var winWidth = 500;
                                                var winTop = (screen.height / 2) - (winHeight / 2);
                                                var winLeft = (screen.width / 2) - (winWidth / 2);
                                                window.open( 'https://www.facebook.com/sharer.php?u=' + current_url, 'sharer', 'top=' + winTop + ',left=' + winLeft + ',toolbar=0,status=0,width='+winWidth+',height='+winHeight);
					}
					if (type=='googleplus') {
						link="https://plus.google.com/share?url=" + encodeURIComponent(msg);
					}
					if (type=='linkedin') {
						link="http://www.linkedin.com/shareArticle?url=" + encodeURIComponent(msg); 
					}
                                        if(link){
					$("a#a"+type).attr("href", link);
					$("a#a"+type).attr("target", "_blank");
                                    }
				}
			});
		}
	}
</script>